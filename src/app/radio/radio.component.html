<div class="flex h-screen bg-gray-100">
  <!-- 確保 audio 元素在最上層 -->
  <audio #audioPlayer></audio>
  
  <p-splitter [style]="{'height': '100vh'}" [panelSizes]="[30,70]">
    <!-- 左側電台列表面板 -->
    <ng-template pTemplate="panel1">
      <div class="h-full bg-white">
        <!-- 搜尋欄 -->
        <div class="p-4 bg-gray-800 text-white sticky top-0 space-y-2">
          <h2 class="text-xl font-bold">電台列表</h2>
          <span class="p-input-icon-left w-full">
            <i class="pi pi-search"></i>
            <input 
              type="text" 
              pInputText 
              [(ngModel)]="searchQuery"
              (input)="filterStations()"
              placeholder="搜尋電台..."
              class="w-full"
            >
          </span>
        </div>
        
        <!-- 精選電台 -->
        <p-accordion [activeIndex]="0">
          <p-accordionTab header="精選電台">
            <div class="divide-y divide-gray-200">
              @for (station of featuredStations; track station.id) {
                <div class="station p-4 hover:bg-gray-50 cursor-pointer"
                     [class.bg-blue-50]="currentStation?.name === station.name"
                     (click)="playStation(station.url_resolved || station.url, station.name)">
                  <div>
                    <strong class="text-lg">{{ station.name }}</strong>
                    <div class="mt-2">
                      @if (station.tags) {
                        @for (tag of (Array.isArray(station.tags) ? station.tags : [station.tags]); track tag) {
                          <p-tag [value]="tag" class="mr-1" severity="info"></p-tag>
                        }
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          </p-accordionTab>

          <!-- 其他電台 -->
          <p-accordionTab header="其他電台 ({{otherStations.length}})">
            <div class="divide-y divide-gray-200">
              @for (station of otherStations; track station.id) {
                <div class="station p-4 hover:bg-gray-50 cursor-pointer"
                     [class.bg-blue-50]="currentStation?.name === station.name"
                     (click)="playStation(station.url_resolved || station.url, station.name)">
                  <div>
                    <strong class="text-lg">{{ station.name }}</strong>
                    <div class="mt-2">
                      @if (station.tags) {
                        @for (tag of (Array.isArray(station.tags) ? station.tags : [station.tags]); track tag) {
                          <p-tag [value]="tag" class="mr-1" severity="info"></p-tag>
                        }
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          </p-accordionTab>
        </p-accordion>
      </div>
    </ng-template>

    <!-- 右側播放控制面板 -->
    <ng-template pTemplate="panel2">
      <div class="flex h-full items-center justify-center">
        <p-card [style]="{'width': '100%', 'max-width': '500px'}" class="p-4">
          <ng-template pTemplate="header">
            <div class="text-center p-4">
              <h3 class="text-2xl font-bold">{{ currentStation?.name || '未選擇電台' }}</h3>
              @if (currentStation?.tags) {
                <div class="mt-2">
                  @for (tag of (Array.isArray(currentStation.tags) ? currentStation.tags : [currentStation.tags]); track tag) {
                    <p-tag [value]="tag" class="mr-1" severity="info"></p-tag>
                  }
                </div>
              }
            </div>
          </ng-template>

          <audio #audioPlayer></audio>

          <!-- 音量控制 -->
          <div class="mb-4">
            <div class="flex items-center gap-2">
              <i class="pi pi-volume-down cursor-pointer" (click)="adjustVolume(-0.1)"></i>
              <p-slider class="flex-1" [ngModel]="volume * 100" (onChange)="onVolumeChange($event)"></p-slider>
              <i class="pi pi-volume-up cursor-pointer" (click)="adjustVolume(0.1)"></i>
            </div>
          </div>

          <!-- 播放進度 -->
          <div class="mb-4">
            <p-slider 
              class="w-full" 
              [ngModel]="currentTime"
              [max]="duration || 100"
              (onChange)="onTimeChange($event)"
            ></p-slider>
            <div class="flex justify-between text-sm text-gray-500">
              <span>{{ formatTime(currentTime) }}</span>
              <span>{{ formatTime(duration) }}</span>
            </div>
          </div>

          <!-- 播放控制 -->
          <div class="flex justify-center">
            <p-button 
              [icon]="isPlaying ? 'pi pi-pause' : 'pi pi-play'"
              [label]="isPlaying ? '暫停' : '播放'"
              (onClick)="togglePlay()"
              [disabled]="!currentStation"
            ></p-button>
          </div>
        </p-card>
      </div>
    </ng-template>
  </p-splitter>
</div>
